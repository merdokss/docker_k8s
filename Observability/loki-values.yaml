# Values dla Grafana Loki
# Instalacja: helm install loki grafana/loki -n monitoring -f loki-values.yaml

# Single binary mode (prostsze dla demo)
deploymentMode: SingleBinary
singleBinary:
  replicas: 1

# Wyłącz wszystkie inne komponenty
read:
  replicas: 0
write:
  replicas: 0
backend:
  replicas: 0

loki:
  auth_enabled: false
  
  # Storage
  storage:
    type: filesystem
    filesystem:
      directory: /loki/chunks
  
  # Schema
  schemaConfig:
    configs:
      - from: 2024-01-01
        store: tsdb
        object_store: filesystem
        schema: v13
        index:
          prefix: index_
          period: 24h
  
  # Retencja
  limits_config:
    retention_period: 720h  # 30 dni
  
  # Kompresja
  compactor:
    retention_enabled: true
    retention_delete_delay: 2h
    retention_delete_worker_count: 150

# Service
service:
  type: ClusterIP
  port: 3100

# Persistence
persistence:
  enabled: true
  size: 30Gi
  storageClassName: ""  # Użyj domyślnego storage class

# Resources
resources:
  requests:
    cpu: 500m
    memory: 1Gi
  limits:
    cpu: 2000m
    memory: 4Gi

# Promtail (opcjonalnie - do zbierania logów z node'ów)
promtail:
  enabled: true
  config:
    clients:
      - url: http://loki:3100/loki/api/v1/push
    scrapeConfigs:
      - job_name: kubernetes-pods
        kubernetes_sd_configs:
          - role: pod
        relabel_configs:
          - source_labels:
              - __meta_kubernetes_pod_node_name
            target_label: __host__
          - action: labelmap
            regex: __meta_kubernetes_pod_label_(.+)
          - action: replace
            replacement: $1
            separator: /
            source_labels:
              - __meta_kubernetes_namespace
              - __meta_kubernetes_pod_name
            target_label: job
          - action: replace
            source_labels:
              - __meta_kubernetes_namespace
            target_label: namespace
          - action: replace
            source_labels:
              - __meta_kubernetes_pod_name
            target_label: pod
          - action: replace
            source_labels:
              - __meta_kubernetes_pod_container_name
            target_label: container
          - replacement: /var/log/pods/*$1/*.log
            separator: /
            source_labels:
              - __meta_kubernetes_pod_uid
              - __meta_kubernetes_pod_container_name
            target_label: __path__

